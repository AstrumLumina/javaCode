<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuanxie.dao.BlogMapper">

    <!--再给mapper作用域使用二级缓存-->
<!--    <cache/>-->

    <!--使用自定义缓存-->
    <cache type="org.mybatis.caches.ehcache.EhcacheCache"/>


    <insert id="addBlog" parameterType="com.xuanxie.pojo.Blog">
        insert into blogs(id, title, author, create_time, views)
        value (#{id}, #{title},#{author}, #{createTime}, #{views});
    </insert>

<!--    <select id="queryBlogDynamic" parameterType="Map" resultType="com.xuanxie.pojo.Blog">-->
<!--        select id, title, author, create_time as createTime, views from blogs where 1=1-->
<!--        <if test="title!=null">-->
<!--            and title like "%"#{title}"%"-->
<!--        </if>-->
<!--        <if test="author!=null">-->
<!--            and author like "%"#{author}"%"-->
<!--        </if>-->
<!--        <if test="views!=null">-->
<!--            and views>#{views}-->
<!--        </if>-->
<!--    </select>-->

    
    <!--sql片段实现复用-->
    <sql id="if-title-author">
        <if test="title!=null">
            and title like "%"#{title}"%"
        </if>
        <if test="author!=null">
            and author like "%"#{author}"%"
        </if>
        <if test="views!=null">
            and views>#{views}
        </if>
    </sql>
    <!--使用 where 标签改进-->
    <select id="queryBlogDynamic" parameterType="Map" resultType="com.xuanxie.pojo.Blog">
        select id, title, author, create_time as createTime, views from blogs
        <where>
            <include refid="if-title-author"></include>
        </where>
    </select>

    <!--choose 等同与switch break;只能选取其中一个-->
    <select id="querryBlogChoose" parameterType="Map" resultType="com.xuanxie.pojo.Blog">
    select id, title, author, create_time as createTime, views from blogs
    <where>
        <choose>
            <when test="title!=null">
                title like "%"#{title}"%"
            </when>
            <when test="author!=null">
                and author like "%"#{author}"%"
            </when>
            <when test="views!=null">
                views>#{views}
            </when>
            <otherwise>
                and views>100
            </otherwise>
        </choose>
    </where>
    </select>

    <update id="update" parameterType="blog" >
        update blogs
        <set>
            <if test="title!=null">
                title=#{title},
            </if>
            <if test="author!=null" >
                author=#{author}
            </if>
        </set>
        where id=#{id}
    </update>


</mapper>